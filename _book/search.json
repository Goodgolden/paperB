[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "PCORI Joint Model",
    "section": "",
    "text": "This is a Quarto book for TSA project.\n\n00_intro.qmd: the data dictionary for tsa datasets\n01_table1.qmd: data cleaning and table1s for each dataset\n02_analysis_plan.qmd: meeting with JG on 1101 and notes"
  },
  {
    "objectID": "intro.html",
    "href": "intro.html",
    "title": "1  Introduction",
    "section": "",
    "text": "This is a book created from markdown and executable code for PCORI dataset\nIn this project, we created three new datasets with full caregiver data:"
  },
  {
    "objectID": "intro.html#caregiver_table_1",
    "href": "intro.html#caregiver_table_1",
    "title": "1  Introduction",
    "section": "1.1 caregiver_table_1",
    "text": "1.1 caregiver_table_1\nThis is the dataset with all the variables at original categories\n\npid: Unique ID for patients\ncid: Unique ID for caregivers\nage [int]: What is your age in years?\ngender [binary]: What is your gender? confirmed\n\n\n1 Male\n2 Female\n3 Other\n\n\nlanguage/spanish [binary]: What language do you prefer to speak or read?\n\n\n1 Spanish\n2 English\n3 Both\n\n\nethnicity [binary]: You consider your ethnicity as:\n\n\n1 Non-Hispanic\n2 Hispanic\n\n\nrace [categorical]: You consider your primary racial background as (Select all that apply):\n\n\n1 race___1 White\n2 race___2 Black\n3 race___3 Asian\n4 race___4 American Indian/Alaska Native\n5 race___5 Hawaiian/Pacific Islander\n6 race___6 Other\n\n\nprimary_caregiver [binary]: Are you the PRIMARY caregiver of a patient diagnosed with lung, head and neck, and/or thyroid cancer?\n\n\n1 Yes\n0 No\n\n\nprimary_reason [binary]: Have you cared for the patient for any reason or illness that is not related to their cancer treatment?\n\n\n1 Yes\n0 No\n\n\nhours [categorical]: How many hours a week do you provide assistance, care, supervision, or companionship to the patient?\n\n\n1 Less than 5 hours\n2 5 to 10 hours\n3 10 to 20 hours\n4 More than 20 hours\n\n\nhousehold [categorical]: How many people in your household (including you) depend on your monthly income?\n\n\n1 as 1\n2 as 2\n3 as 3\n4 as 4\n5 as 5\n6 as 6\n7 as 7\n8 as 8 or more\n\n\nrelationship [categorical]: What is your role in the relationship with the patient? a lot of people answer this question wrong…\n\n\n1 Husband/partner\n2 Wife/partner\n3 Mother\n4 Father\n5 Daughter\n6 Son\n7 Sister\n8 Brother\n9 Other relative\n10 Non-relative\n\n\nemployed [binary]: Are you now employed?\n\n\n1 Yes\n0 No\n\n\nretired [binary]: Are you retired?\n\n\n1 Yes\n0 No\n-1 Unknown\n\n\neducation [categorical]: Choose the highest level of education you’ve completed\n\n\n0 Missing or unknown\n1 Grade school- 1\n2 Grade school- 2\n3 Grade school- 3\n4 Grade school- 4\n5 Grade school- 5\n6 Grade school- 6\n7 Grade school- 7\n8 Grade school- 8\n9 High school- 9\n10 High school- 10\n11 High school- 11\n12 High school- 12\n13 College- 1\n14 College- 2\n15 College- 3\n16 College- 4\n17 Post graduate- 5\n18 Post graduate- 6\n19 Post graduate- 7\n20 Post-graduate- 8+\n\n\nincome [categorical]: Pick the category that best describes where your monthly income (after taxes) falls.\n\n\n0 Minssing or unknown\n1 Less than $4,000\n2 Less than $5,400\n3 Less than $7,100\n4 Less than $8,100\n5 Less than $9,500\n6 Less than $10,900\n7 Less than $12,300\n8 Less than $13,700\n9 More than $13,701\n\n\nrandomize [binary]: randomization intervention condition\n\n\n0 Control\n1 Intervention\n\n\ndiagnosis [categorical]: What is the primary diagnosis of the patient you care for?\n\n\n1 Lung cancer\n2 Head and neck cancer\n3 Other cancer\n4 Thyroid cancer\n\n\nstage [categorical]: At what stage was the patient’s cancer diagnosed?\n\n\n0 Stage 0\n1 Stage I\n2 Stage II\n3 Stage III\n4 Stage IV\n5 Pending or Unknown\n\n\nstep [categorical]: Step at baseline\n\n\n1 Step 1\n2 Step 2\n3 Step 3\n4 Step 4\n5 Unknown\n\n\nhospital [categorical]: What hospital are you associated with?\n\n\n1 Denver Health\n2 St.Joe’s\n3 St.Mary’s\n4 National Jewish\n5 UCCC"
  },
  {
    "objectID": "intro.html#caregiver_table_2-and-caregiver_table_3",
    "href": "intro.html#caregiver_table_2-and-caregiver_table_3",
    "title": "1  Introduction",
    "section": "1.2 caregiver_table_2 and caregiver_table_3",
    "text": "1.2 caregiver_table_2 and caregiver_table_3\nThose are the datasets with merged or combined categories\n\npid: Unique ID for patients\ncid: Unique ID for caregivers\nage [int]: What is your age in years?\nage_binary [binary]: Whether you are older than 60 years old?\n\n\n\nYes\n\n\nNo\n\n\n\ngender [binary]: What is your gender? confirmed no missing\n\n\n1 Male\n2 Female\n\n\nlanguage/spanish [binary]: What language do you prefer to speak or read?\n\n\n1 Spanish\n2 English or both\n\n\nethnicity [binary]: You consider your ethnicity as:\n\n\n1 Non-Hispanic\n2 Hispanic\n\n\nrace [categorical]: You consider your primary racial background as (Select all that apply):\n\n\n1 race White\n2 race Other\n\n\nprimary_caregiver [binary]: Are you the PRIMARY caregiver of a patient diagnosed with lung, head and neck, and/or thyroid cancer?\n\n\n1 Yes\n2 No\n\n\nprimary_reason [binary]: Have you cared for the patient for any reason or illness that is not related to their cancer treatment?\n\n\n1 Yes\n2 No\n0 Missing\n\n\nhours [categorical]: How many hours a week do you provide assistance, care, supervision, or companionship to the patient?\n\n\n0 Missing\n1 Less than 10 hours\n2 More than 10 hours\n\n\nhousehold [categorical]: How many people in your household (including you) depend on your monthly income?\n\n\n0 as Missing\n1 as Single person\n2 as Two people\n3 as More than two people\n\n\nrelationship [categorical]: What is your role in the relationship with the patient? a lot of people answer this question wrong…\n\n\n0 Missing\n1 Couple or partner\n2 Parents or children\n3 Others relative or non-relative\n\n\nemployed [binary]: Are you now employed?\n\n\n0 Missing\n1 Yes\n2 No\n\n\neducation [categorical]: Choose the highest level of education you’ve completed\n\n\n0 Missing or unknown\n1 High school level\n2 College or graduate level\n\n\nincome [categorical]: Pick the category that best describes where your monthly income (after taxes) falls.\n\n\n0 Minssing or unknown\n1 Less than $4,000\n2 More than $5,400\n\n\nrandomize [binary]: randomization intervention condition\n\n\n0 Control\n1 Intervention\n\n\ndiagnosis [categorical]: What is the primary diagnosis of the patient you care for?\n\n\n0 Missing\n1 Lung cancer\n2 Head and neck cancer (including Thyroid cancer)\n\n\nstage [categorical]: At what stage was the patient’s cancer diagnosed?\n\n\n1 Stage 0 I II\n2 Stage III IV\n0 Pending or Unknown\n\n\nstep [categorical]: Step at baseline\n\n\n1 Step 1 & 2\n2 Step 3 & 4\n0 Pending or Unknown\n\n\nhospital [categorical]: What hospital are you associated with?\n\n\n1 Denver Health\n2 St.Joe’s\n3 St.Mary’s\n4 National Jewish\n5 UCCC"
  },
  {
    "objectID": "01_table1.html",
    "href": "01_table1.html",
    "title": "\n2  Caregiver Table1\n",
    "section": "",
    "text": "run the source(\"01_table1.R\") to update the caregiver table1 dataset\n\nCodeload(\"new_data/demo_clean_caregiver_factor_2_2023-11-02.Rdata\")\nload(\"new_data/demo_clean_caregiver_merge_2_2023-11-02.Rdata\")\n\ncg3 <- caregiver_table_2 %>% \n  stddiff::stddiff.numeric(gcol = 17, \n                           ## 3 age\n                           vcol = 3) %>%\n  as.data.frame() %>%\n  select(stddiff)\n\ncgn <- caregiver_table_2 %>% \n  stddiff::stddiff.category(gcol = 17, \n                           vcol = c(4:16, 18:21)) %>%\n  as.data.frame() %>%\n  select(stddiff)\n\nstd_cg <- rbind(cg3, cgn)\n\n\n\n\n\n\nCodecaregiver_table_2\n\n\n\n  \n\n\nCodecaregiver_table_3\n\n\n\n  \n\n\n\n\nCodetable1_caregiver <- caregiver_table_3 %>% \n  dplyr::select(-cid, -pid) %>%\n  tbl_summary(by = randomize,\n              type = all_continuous() ~ \"continuous\",\n              statistic = list(all_continuous() ~ \"{mean} / {median} ({p25}, {p75})\")) %>%\n  add_p() %>%\n  # add overall column\n  modify_header(label = \"**Variable**\",\n                p.value = \"**Std Diff**\") \n\n\nstd_cg <- unlist(std_cg) %>% na.omit()\ntable1_caregiver$table_body$p.value[!is.na(table1_caregiver$table_body$p.value)] <- std_cg\n# cbind(table1_caregiver$table_body$variable, table1_caregiver$table_body$p.value)\n\nfootnote_cg <- \n  c(a = 'Age binary',\n      # 'Caregiver: the primary caregiver to the reference group non-primary',\n    b = 'gender',\n      # 'Primary Reason: the primary caregiving reason of disease related to the reference group of not related',\n    c = 'Language',\n      # 'Employed: the caregiver is employed to the reference group of unemployed', \n    d = 'Ethnicity',\n      # 'Retired: the caregiver is retired to the reference group of non-retired',\n    e = 'Race',\n      # 'Education: the caregiver received college or higher education to the reference group of high school or lower education', \n    f = 'Primary Caregiver',\n      # 'Language: the caregiver perfer English as first language to reference group of Spanish',\n    g = 'Gender: the caregiver is female to reference group of male')\n\ntable1_caregiver %>%\n  bold_labels() %>%\n  italicize_labels() %>%\n  gtsummary::as_flex_table() %>%\n  flextable::footnote(i =           c(2,      5,     8,   11,  14,    17,  31), #   22,  26,   31,   35,  \n                      ref_symbols = c(\" a\", \" b\", \" c\", \" d\", \" e\", \" f\", \" g\"),# \" g\", \" h\", \" i\", \" j\", \" k\", \n                      j = 1,\n                      value = as_paragraph(footnote_cg),\n                      part = \"body\") %>%\n  flextable::theme_booktabs() %>%\n  flextable::autofit() %>%\n  flextable::bold(bold = TRUE,\n                  part = \"header\") \n\n\n\n\n\nCaregiver Table1\n\nVariable\nMissing, N = 1311\nUsual care, N = 1181\nStd Diff2\n\n\n\nage\n57 / 58 (47, 68)\n55 / 60 (42, 68)\n0.13\n\n\nage_binary a\n\n\n0.055\n\n\nOlder than 60\n63 (48%)\n60 (51%)\n\n\n\nYoung than 60\n68 (52%)\n58 (49%)\n\n\n\ngender b\n\n\n0.057\n\n\nFemale\n99 (76%)\n92 (78%)\n\n\n\nMale\n32 (24%)\n26 (22%)\n\n\n\nlanguage c\n\n\n0.2\n\n\nEnglish or Both\n112 (85%)\n109 (92%)\n\n\n\nSpanish\n19 (15%)\n9 (7.6%)\n\n\n\nethnicity d\n\n\n0.10\n\n\nHispanic\n37 (28%)\n28 (24%)\n\n\n\nNon-Hispanic\n94 (72%)\n90 (76%)\n\n\n\nrace_white e\n\n\n0.059\n\n\nOther\n24 (18%)\n19 (16%)\n\n\n\nWhite\n107 (82%)\n99 (84%)\n\n\n\nprimary_caregiver f\n105 (80%)\n93 (79%)\n0.033\n\n\nprimary_reason\n\n\n0.3\n\n\nMissing\n2 (1.5%)\n3 (2.5%)\n\n\n\nNo\n65 (50%)\n74 (63%)\n\n\n\nYes\n64 (49%)\n41 (35%)\n\n\n\nhours\n\n\n0.2\n\n\nLess than 10 hours\n37 (28%)\n42 (36%)\n\n\n\nMissing\n16 (12%)\n10 (8.5%)\n\n\n\nMore than 10 hours\n78 (60%)\n66 (56%)\n\n\n\nhousehold\n\n\n0.2\n\n\nMissing\n5 (3.8%)\n3 (2.5%)\n\n\n\nMore than two\n25 (19%)\n32 (27%)\n\n\n\nOne\n34 (26%)\n27 (23%)\n\n\n\nTwo\n67 (51%)\n56 (47%)\n\n\n\nrelationship g\n\n\n0.045\n\n\nCouples or partners\n66 (50%)\n62 (53%)\n\n\n\nOther relationships\n18 (14%)\n16 (14%)\n\n\n\nParents or Children\n47 (36%)\n40 (34%)\n\n\n\nemployed\n52 (40%)\n54 (46%)\n0.12\n\n\neducation\n\n\n0.3\n\n\nCollege or graduate school\n72 (55%)\n79 (67%)\n\n\n\nHigh school or lower\n59 (45%)\n38 (32%)\n\n\n\nMissing\n0 (0%)\n1 (0.8%)\n\n\n\nincome\n\n\n0.2\n\n\nLess than 4000\n84 (64%)\n84 (71%)\n\n\n\nMissing\n10 (7.6%)\n5 (4.2%)\n\n\n\nMore than 4000\n37 (28%)\n29 (25%)\n\n\n\ndiagnosis\n\n\n0.14\n\n\nHead & Neck cancer\n53 (40%)\n40 (34%)\n\n\n\nLung cancer\n78 (60%)\n78 (66%)\n\n\n\nstage\n\n\n0.087\n\n\nEarly\n51 (39%)\n43 (36%)\n\n\n\nLate\n74 (56%)\n71 (60%)\n\n\n\nMissing\n6 (4.6%)\n4 (3.4%)\n\n\n\nstep\n\n\n0.13\n\n\nEarly\n106 (81%)\n89 (75%)\n\n\n\nLate\n25 (19%)\n29 (25%)\n\n\n\nhospital\n\n\n0.2\n\n\nDenver Health\n30 (23%)\n26 (22%)\n\n\n\nNational Jewish\n19 (15%)\n22 (19%)\n\n\n\nSt.Joes\n15 (11%)\n10 (8.5%)\n\n\n\nSt.Marys\n60 (46%)\n57 (48%)\n\n\n\nUCCC\n7 (5.3%)\n3 (2.5%)\n\n\n\n\n1Mean / Median (IQR); n (%)\n2Wilcoxon rank sum test; Pearson's Chi-squared test; Fisher's exact test\n aAge binary\n bgender\n cLanguage\n dEthnicity\n eRace\n fPrimary Caregiver\n gGender: the caregiver is female to reference group of male\n\n\n\n\n\n\nCode## save the latex .text file\nlibrary(xtable)\n# xtable(table0, type = \"latex\", \n#        file = paste0(\"figure/S01_plmlmm_table0_\", Sys.Date(), \".tex\"))\n# print(xtable(table0, type = \"latex\"),\n#       file = paste0(\"figure/S01_plmlmm_table0_\", Sys.Date(), \".tex\"))\n# xtable(table1, type = \"latex\", \n#        file = paste0(\"figure/S01_plmlmm_table1_\", Sys.Date(), \".tex\"))\nprint(xtable(as.data.frame(table1_caregiver), type = \"latex\"),\n      file = paste0(\"figure/T01_table1_caregiver_pvalue_\", Sys.Date(), \".tex\"))"
  },
  {
    "objectID": "02_propensity.html",
    "href": "02_propensity.html",
    "title": "\n3  Propensity Score\n",
    "section": "",
    "text": "This is to say that you should not be relying on the features of twang or WeightIt to automatically address missing data; rather, you should use multiple imputation, which is the overwhelmingly recommended approach. There is a new R package that I have worked on called MatchThem, which is a wrapper for WeightIt for multiply imputed datasets. It makes using WeightIt with multiply imputed data really easy.\n\nShow the codeload(\"new_data/demo_clean_caregiver_merge_2_2023-11-02.Rdata\") \n# caregiver_table_2 <- caregiver_table_2 %>%\n#   mutate(randomize = as.numeric(randomize))\nset.seed(555)\n\ntic()\nps_gbm <- ps(randomize ~ primary_caregiver + primary_reason + employed +\n               education + language + gender + ethnicity + race + \n               diagnosis + stage + step + income + household + age + \n               relationship + hours + hospital,\n             data = caregiver_table_2,\n             ## the number of gbm iterations passed to gbm\n             n.trees = 5000,\n             ## the tree depth used in gradient boosting\n             interaction.depth = 2,\n             shrinkage = 0.01,\n             ## \"ATE\" (average treatment effect) \n             ## \"ATT\" (average treatment effect on the treated)\n             estimand = \"ATT\", \n             ## minimizes the average absolute standardized effect size\n             ## maximum KS statistic \n             ## the Kolmogorov-Smirnov statistic \n             ## es refers to standardized effect size. \n             stop.method = c(\"es.mean\", \"ks.max\"),\n             ## the minimum number of observations in the terminal nodes\n             ## of the trees used in the gradient boosting\n             n.minobsinnode = 10,\n             n.keep = 1,\n             ## A numeric variable that sets the grid size for \n             ## an initial search of the region most likely to \n             ## minimize the stop.method.\n             n.grid = 25,\n             ks.exact = NULL,\n             verbose = FALSE)\ntoc()\n\n1.534 sec elapsed\n\n\n\n\n\n\nShow the codesummary(ps_gbm)\n\n            n.treat n.ctrl ess.treat  ess.ctrl    max.es    mean.es     max.ks\nunw             131    118       131 118.00000 0.2822580 0.11043944 0.14109199\nes.mean.ATT     131    118       131  84.13390 0.1768754 0.07053865 0.08899922\nks.max.ATT      131    118       131  87.88799 0.1689008 0.08103827 0.08403354\n            max.ks.p    mean.ks iter\nunw               NA 0.04697920   NA\nes.mean.ATT       NA 0.02995796 1058\nks.max.ATT        NA 0.03409130  534\n\n\n\nks refers to the Kolmogorov-Smirnov statistic\nes refers to standardized effect size.\n\n\nShow the codeplot(ps_gbm)\nplot(ps_gbm, plots = \"boxplot\")\n\n\n\ncaregiver balance measure\n\n\n\n\n\n\natt propensity score boxplot\n\n\n\nCaregiver propensity score\n\n\nShow the codecaregiver_balance <- bal.table(ps_gbm)\n\ncaregiver_balance\n\n$unw\n                     tx.mn  tx.sd  ct.mn  ct.sd std.eff.sz  stat  pval    ks\nprimary_caregiver:1  0.802  0.399  0.788  0.409      0.034 0.068 0.794 0.013\nprimary_caregiver:2  0.198  0.399  0.212  0.409     -0.034    NA    NA 0.013\nprimary_reason:0     0.015  0.123  0.025  0.157     -0.083 2.568 0.078 0.010\nprimary_reason:1     0.489  0.500  0.347  0.476      0.282    NA    NA 0.141\nprimary_reason:2     0.496  0.500  0.627  0.484     -0.262    NA    NA 0.131\nemployed:1           0.397  0.489  0.458  0.498     -0.124 0.931 0.335 0.061\nemployed:2           0.603  0.489  0.542  0.498      0.124    NA    NA 0.061\neducation:0          0.000     NA  0.008  0.092         NA 2.598 0.075 0.008\neducation:1          0.450  0.498  0.322  0.467      0.258    NA    NA 0.128\neducation:2          0.550  0.498  0.669  0.470     -0.241    NA    NA 0.120\nlanguage:1           0.145  0.352  0.076  0.265      0.195 2.930 0.088 0.069\nlanguage:2           0.855  0.352  0.924  0.265     -0.195    NA    NA 0.069\ngender:1             0.244  0.430  0.220  0.414      0.056 0.198 0.657 0.024\ngender:2             0.756  0.430  0.780  0.414     -0.056    NA    NA 0.024\nethnicity:1          0.718  0.450  0.763  0.425     -0.100 0.654 0.420 0.045\nethnicity:2          0.282  0.450  0.237  0.425      0.100    NA    NA 0.045\nrace:1               0.817  0.387  0.839  0.368     -0.057 0.213 0.645 0.022\nrace:2               0.183  0.387  0.161  0.368      0.057    NA    NA 0.022\ndiagnosis:1          0.595  0.491  0.661  0.473     -0.134 1.137 0.287 0.066\ndiagnosis:2          0.405  0.491  0.339  0.473      0.134    NA    NA 0.066\nstage:0              0.046  0.209  0.034  0.181      0.057 0.232 0.793 0.012\nstage:1              0.389  0.488  0.364  0.481      0.051    NA    NA 0.025\nstage:2              0.565  0.496  0.602  0.490     -0.074    NA    NA 0.037\nstep:1               0.809  0.393  0.754  0.431      0.140 1.098 0.296 0.055\nstep:2               0.191  0.393  0.246  0.431     -0.140    NA    NA 0.055\nincome:0             0.076  0.266  0.042  0.201      0.128 0.978 0.377 0.034\nincome:1             0.641  0.480  0.712  0.453     -0.147    NA    NA 0.071\nincome:2             0.282  0.450  0.246  0.431      0.081    NA    NA 0.037\nhousehold:0          0.038  0.192  0.025  0.157      0.067 0.822 0.482 0.013\nhousehold:1          0.260  0.438  0.229  0.420      0.070    NA    NA 0.031\nhousehold:2          0.511  0.500  0.475  0.499      0.074    NA    NA 0.037\nhousehold:3          0.191  0.393  0.271  0.445     -0.204    NA    NA 0.080\nage                 57.206 13.617 55.263 16.460      0.143 1.011 0.313 0.120\nrelationship:1       0.504  0.500  0.525  0.499     -0.043 0.063 0.938 0.022\nrelationship:2       0.359  0.480  0.339  0.473      0.041    NA    NA 0.020\nrelationship:3       0.137  0.344  0.136  0.342      0.005    NA    NA 0.002\nhours:0              0.122  0.327  0.085  0.279      0.114 1.010 0.365 0.037\nhours:1              0.282  0.450  0.356  0.479     -0.163    NA    NA 0.073\nhours:2              0.595  0.491  0.559  0.496      0.074    NA    NA 0.036\nhospital:1           0.229  0.420  0.220  0.414      0.021 0.625 0.645 0.009\nhospital:2           0.115  0.318  0.085  0.279      0.093    NA    NA 0.030\nhospital:3           0.458  0.498  0.483  0.500     -0.050    NA    NA 0.025\nhospital:4           0.145  0.352  0.186  0.389     -0.118    NA    NA 0.041\nhospital:5           0.053  0.225  0.025  0.157      0.125    NA    NA 0.028\n                    ks.pval\nprimary_caregiver:1   0.794\nprimary_caregiver:2      NA\nprimary_reason:0      0.078\nprimary_reason:1         NA\nprimary_reason:2         NA\nemployed:1            0.335\nemployed:2               NA\neducation:0           0.075\neducation:1              NA\neducation:2              NA\nlanguage:1            0.088\nlanguage:2               NA\ngender:1              0.657\ngender:2                 NA\nethnicity:1           0.420\nethnicity:2              NA\nrace:1                0.645\nrace:2                   NA\ndiagnosis:1           0.287\ndiagnosis:2              NA\nstage:0               0.793\nstage:1                  NA\nstage:2                  NA\nstep:1                0.296\nstep:2                   NA\nincome:0              0.377\nincome:1                 NA\nincome:2                 NA\nhousehold:0           0.482\nhousehold:1              NA\nhousehold:2              NA\nhousehold:3              NA\nage                   0.331\nrelationship:1        0.938\nrelationship:2           NA\nrelationship:3           NA\nhours:0               0.365\nhours:1                  NA\nhours:2                  NA\nhospital:1            0.645\nhospital:2               NA\nhospital:3               NA\nhospital:4               NA\nhospital:5               NA\n\n$es.mean.ATT\n                     tx.mn  tx.sd  ct.mn  ct.sd std.eff.sz   stat  pval    ks\nprimary_caregiver:1  0.802  0.399  0.814  0.389     -0.032  0.050 0.824 0.013\nprimary_caregiver:2  0.198  0.399  0.186  0.389      0.032     NA    NA 0.013\nprimary_reason:0     0.015  0.123  0.023  0.150     -0.062  0.136 0.871 0.008\nprimary_reason:1     0.489  0.500  0.464  0.499      0.050     NA    NA 0.025\nprimary_reason:2     0.496  0.500  0.513  0.500     -0.034     NA    NA 0.017\nemployed:1           0.397  0.489  0.391  0.488      0.011  0.006 0.936 0.005\nemployed:2           0.603  0.489  0.609  0.488     -0.011     NA    NA 0.005\neducation:0          0.000     NA  0.007  0.082         NA  1.414 0.244 0.007\neducation:1          0.450  0.498  0.362  0.481      0.177     NA    NA 0.088\neducation:2          0.550  0.498  0.631  0.483     -0.163     NA    NA 0.081\nlanguage:1           0.145  0.352  0.117  0.322      0.079  0.240 0.625 0.028\nlanguage:2           0.855  0.352  0.883  0.322     -0.079     NA    NA 0.028\ngender:1             0.244  0.430  0.208  0.406      0.085  0.402 0.527 0.036\ngender:2             0.756  0.430  0.792  0.406     -0.085     NA    NA 0.036\nethnicity:1          0.718  0.450  0.750  0.433     -0.072  0.249 0.618 0.032\nethnicity:2          0.282  0.450  0.250  0.433      0.072     NA    NA 0.032\nrace:1               0.817  0.387  0.866  0.341     -0.126  0.976 0.324 0.049\nrace:2               0.183  0.387  0.134  0.341      0.126     NA    NA 0.049\ndiagnosis:1          0.595  0.491  0.622  0.485     -0.054  0.144 0.704 0.026\ndiagnosis:2          0.405  0.491  0.378  0.485      0.054     NA    NA 0.026\nstage:0              0.046  0.209  0.027  0.163      0.089  0.388 0.674 0.019\nstage:1              0.389  0.488  0.368  0.482      0.043     NA    NA 0.021\nstage:2              0.565  0.496  0.604  0.489     -0.080     NA    NA 0.039\nstep:1               0.809  0.393  0.787  0.409      0.055  0.143 0.706 0.022\nstep:2               0.191  0.393  0.213  0.409     -0.055     NA    NA 0.022\nincome:0             0.076  0.266  0.071  0.257      0.019  0.249 0.777 0.005\nincome:1             0.641  0.480  0.689  0.463     -0.099     NA    NA 0.048\nincome:2             0.282  0.450  0.240  0.427      0.094     NA    NA 0.043\nhousehold:0          0.038  0.192  0.024  0.152      0.076  0.444 0.720 0.014\nhousehold:1          0.260  0.438  0.208  0.406      0.117     NA    NA 0.051\nhousehold:2          0.511  0.500  0.557  0.497     -0.090     NA    NA 0.045\nhousehold:3          0.191  0.393  0.212  0.408     -0.053     NA    NA 0.021\nage                 57.206 13.617 58.204 13.501     -0.073 -0.558 0.577 0.089\nrelationship:1       0.504  0.500  0.549  0.498     -0.091  0.232 0.793 0.046\nrelationship:2       0.359  0.480  0.318  0.466      0.086     NA    NA 0.041\nrelationship:3       0.137  0.344  0.133  0.340      0.013     NA    NA 0.004\nhours:0              0.122  0.327  0.088  0.283      0.104  0.534 0.586 0.034\nhours:1              0.282  0.450  0.334  0.472     -0.115     NA    NA 0.052\nhours:2              0.595  0.491  0.578  0.494      0.036     NA    NA 0.018\nhospital:1           0.229  0.420  0.241  0.428     -0.029  0.199 0.937 0.012\nhospital:2           0.115  0.318  0.097  0.296      0.054     NA    NA 0.017\nhospital:3           0.458  0.498  0.483  0.500     -0.050     NA    NA 0.025\nhospital:4           0.145  0.352  0.148  0.355     -0.008     NA    NA 0.003\nhospital:5           0.053  0.225  0.031  0.173      0.100     NA    NA 0.022\n                    ks.pval\nprimary_caregiver:1   0.824\nprimary_caregiver:2      NA\nprimary_reason:0      0.871\nprimary_reason:1         NA\nprimary_reason:2         NA\nemployed:1            0.936\nemployed:2               NA\neducation:0           0.244\neducation:1              NA\neducation:2              NA\nlanguage:1            0.625\nlanguage:2               NA\ngender:1              0.527\ngender:2                 NA\nethnicity:1           0.618\nethnicity:2              NA\nrace:1                0.324\nrace:2                   NA\ndiagnosis:1           0.704\ndiagnosis:2              NA\nstage:0               0.674\nstage:1                  NA\nstage:2                  NA\nstep:1                0.706\nstep:2                   NA\nincome:0              0.777\nincome:1                 NA\nincome:2                 NA\nhousehold:0           0.720\nhousehold:1              NA\nhousehold:2              NA\nhousehold:3              NA\nage                   0.812\nrelationship:1        0.793\nrelationship:2           NA\nrelationship:3           NA\nhours:0               0.586\nhours:1                  NA\nhours:2                  NA\nhospital:1            0.937\nhospital:2               NA\nhospital:3               NA\nhospital:4               NA\nhospital:5               NA\n\n$ks.max.ATT\n                     tx.mn  tx.sd  ct.mn  ct.sd std.eff.sz   stat  pval    ks\nprimary_caregiver:1  0.802  0.399  0.801  0.399      0.001  0.000 0.997 0.000\nprimary_caregiver:2  0.198  0.399  0.199  0.399     -0.001     NA    NA 0.000\nprimary_reason:0     0.015  0.123  0.027  0.162     -0.096  0.351 0.704 0.012\nprimary_reason:1     0.489  0.500  0.444  0.497      0.090     NA    NA 0.045\nprimary_reason:2     0.496  0.500  0.529  0.499     -0.067     NA    NA 0.033\nemployed:1           0.397  0.489  0.402  0.490     -0.011  0.006 0.938 0.005\nemployed:2           0.603  0.489  0.598  0.490      0.011     NA    NA 0.005\neducation:0          0.000     NA  0.006  0.079         NA  1.287 0.276 0.006\neducation:1          0.450  0.498  0.366  0.482      0.169     NA    NA 0.084\neducation:2          0.550  0.498  0.627  0.484     -0.156     NA    NA 0.078\nlanguage:1           0.145  0.352  0.115  0.319      0.086  0.267 0.606 0.030\nlanguage:2           0.855  0.352  0.885  0.319     -0.086     NA    NA 0.030\ngender:1             0.244  0.430  0.192  0.394      0.121  0.899 0.344 0.052\ngender:2             0.756  0.430  0.808  0.394     -0.121     NA    NA 0.052\nethnicity:1          0.718  0.450  0.746  0.435     -0.064  0.193 0.661 0.029\nethnicity:2          0.282  0.450  0.254  0.435      0.064     NA    NA 0.029\nrace:1               0.817  0.387  0.859  0.348     -0.108  0.740 0.391 0.042\nrace:2               0.183  0.387  0.141  0.348      0.108     NA    NA 0.042\ndiagnosis:1          0.595  0.491  0.645  0.479     -0.101  0.547 0.460 0.050\ndiagnosis:2          0.405  0.491  0.355  0.479      0.101     NA    NA 0.050\nstage:0              0.046  0.209  0.026  0.160      0.094  0.430 0.646 0.020\nstage:1              0.389  0.488  0.370  0.483      0.039     NA    NA 0.019\nstage:2              0.565  0.496  0.604  0.489     -0.078     NA    NA 0.039\nstep:1               0.809  0.393  0.763  0.425      0.117  0.600 0.439 0.046\nstep:2               0.191  0.393  0.237  0.425     -0.117     NA    NA 0.046\nincome:0             0.076  0.266  0.062  0.241      0.054  0.391 0.675 0.014\nincome:1             0.641  0.480  0.700  0.458     -0.122     NA    NA 0.058\nincome:2             0.282  0.450  0.238  0.426      0.098     NA    NA 0.044\nhousehold:0          0.038  0.192  0.025  0.156      0.069  0.460 0.710 0.013\nhousehold:1          0.260  0.438  0.206  0.404      0.123     NA    NA 0.054\nhousehold:2          0.511  0.500  0.557  0.497     -0.092     NA    NA 0.046\nhousehold:3          0.191  0.393  0.212  0.409     -0.054     NA    NA 0.021\nage                 57.206 13.617 58.123 13.613     -0.067 -0.520 0.604 0.083\nrelationship:1       0.504  0.500  0.551  0.497     -0.095  0.264 0.767 0.047\nrelationship:2       0.359  0.480  0.315  0.464      0.092     NA    NA 0.044\nrelationship:3       0.137  0.344  0.134  0.341      0.009     NA    NA 0.003\nhours:0              0.122  0.327  0.088  0.283      0.104  0.817 0.442 0.034\nhours:1              0.282  0.450  0.356  0.479     -0.163     NA    NA 0.073\nhours:2              0.595  0.491  0.556  0.497      0.080     NA    NA 0.039\nhospital:1           0.229  0.420  0.240  0.427     -0.026  0.248 0.910 0.011\nhospital:2           0.115  0.318  0.099  0.298      0.050     NA    NA 0.016\nhospital:3           0.458  0.498  0.475  0.499     -0.034     NA    NA 0.017\nhospital:4           0.145  0.352  0.158  0.365     -0.037     NA    NA 0.013\nhospital:5           0.053  0.225  0.028  0.166      0.111     NA    NA 0.025\n                    ks.pval\nprimary_caregiver:1   0.997\nprimary_caregiver:2      NA\nprimary_reason:0      0.704\nprimary_reason:1         NA\nprimary_reason:2         NA\nemployed:1            0.938\nemployed:2               NA\neducation:0           0.276\neducation:1              NA\neducation:2              NA\nlanguage:1            0.606\nlanguage:2               NA\ngender:1              0.344\ngender:2                 NA\nethnicity:1           0.661\nethnicity:2              NA\nrace:1                0.391\nrace:2                   NA\ndiagnosis:1           0.460\ndiagnosis:2              NA\nstage:0               0.646\nstage:1                  NA\nstage:2                  NA\nstep:1                0.439\nstep:2                   NA\nincome:0              0.675\nincome:1                 NA\nincome:2                 NA\nhousehold:0           0.710\nhousehold:1              NA\nhousehold:2              NA\nhousehold:3              NA\nage                   0.864\nrelationship:1        0.767\nrelationship:2           NA\nrelationship:3           NA\nhours:0               0.442\nhours:1                  NA\nhours:2                  NA\nhospital:1            0.910\nhospital:2               NA\nhospital:3               NA\nhospital:4               NA\nhospital:5               NA\n\n\n\nShow the code# summary(ps_gbm$gbm.obj, plot = TRUE)\nsummary(ps_gbm$gbm.obj,\n        ## choose the number of iterations to be the optimal number\n        ## for minimizing the largest of the KS statistics\n        n.trees = ps_gbm$desc$es.mean.ATT$n.trees,\n        plot = TRUE)\n\n\n\nrelative influence\n\n\n\n\n\n\n\n\nrelative influence\n\n\n\nShow the codelibrary(survey)\n## get.weights is from twang package\ncaregiver_table_2$w <- get.weights(ps_gbm, \n                         ## stop.method specifies which gbm weights to use\n                         stop.method = \"es.mean\")\n## svydesign is from survey package\ndesign.ps <- svydesign(ids = ~1, \n                       weights = ~w, \n                       data = caregiver_table_2)\n\n\n\nShow the code## this is the working dataset for the paper analysis\ncaregiver_score <- read.csv(\"new_data/score_caregiver_survey_scored.csv\")\ndata2 <- caregiver_score %>%\n  mutate(cid = as.character(uniqueid2)) %>%\n  dplyr::select(-record_id, -spanish, -randomize, -language,\n                -stage, -stage2, -diagnosis, -diagn.lc, \n                -gender_clean, -hospital, -status2) %>%\n  inner_join(caregiver_table_2, by = join_by(cid == cid)) %>%\n  dplyr::select(cid, pid, randomize, everything()) %>%\n  na.omit()\n\n\n??? weight in lme() is the variance function Hence, I should use weights = ~ I(1/b) in lme() to have the variance of \\(\\epsilon_i = 1/b_i\\)\nIn lm() what you pass weights seems is the exact opposite; weights is inversely proportional to the variance.\n\nShow the codelibrary(nlme)\nmod0 <- lme(zbi ~ 0 + stage + step + diagnosis + age + gender + randomize * time,\n            random = list(~1 | hospital,\n                          ~1 | cid), \n            data = data2)\nsummary(mod0)\n\nLinear mixed-effects model fit by REML\n  Data: data2 \n       AIC      BIC    logLik\n  4442.998 4501.632 -2208.499\n\nRandom effects:\n Formula: ~1 | hospital\n         (Intercept)\nStdDev: 0.0009824235\n\n Formula: ~1 | cid %in% hospital\n        (Intercept) Residual\nStdDev:    5.495826 4.823554\n\nFixed effects:  zbi ~ 0 + stage + step + diagnosis + age + gender + randomize *      time \n                   Value Std.Error  DF   t-value p-value\nstage0          5.962835  4.173057 209  1.428889  0.1545\nstage1          6.697795  2.195179 209  3.051138  0.0026\nstage2          9.798125  2.101801 209  4.661775  0.0000\nstep2           5.869533  1.079365 209  5.437951  0.0000\ndiagnosis2      0.549354  0.880604 209  0.623837  0.5334\nage            -0.001503  0.029333 209 -0.051238  0.9592\ngender2         1.112904  1.038967 209  1.071164  0.2853\nrandomize      -1.994610  0.939235 209 -2.123654  0.0349\ntime            0.118943  0.029233 460  4.068761  0.0001\nrandomize:time -0.052179  0.043214 460 -1.207465  0.2279\n Correlation: \n               stage0 stage1 stage2 step2  dgnss2 age    gendr2 randmz time  \nstage1          0.471                                                        \nstage2          0.480  0.915                                                 \nstep2          -0.102 -0.211 -0.284                                          \ndiagnosis2     -0.086 -0.204 -0.152  0.005                                   \nage            -0.480 -0.814 -0.842  0.203  0.050                            \ngender2        -0.124 -0.456 -0.423 -0.078 -0.020  0.086                     \nrandomize      -0.116 -0.183 -0.197  0.070 -0.079 -0.040  0.000              \ntime           -0.061 -0.118 -0.124  0.002  0.019 -0.026 -0.002  0.317       \nrandomize:time  0.046  0.085  0.093  0.013 -0.013  0.003  0.006 -0.421 -0.676\n\nStandardized Within-Group Residuals:\n        Min          Q1         Med          Q3         Max \n-3.84515190 -0.47807062 -0.08978088  0.46101892  4.43214224 \n\nNumber of Observations: 682\nNumber of Groups: \n         hospital cid %in% hospital \n                5               221 \n\nShow the codemod1 <- lme(zbi ~ 0 + w + randomize * time, \n            random = list(~1 | hospital,\n                          ~1 | cid), \n            data = data2)\nsummary(mod1)\n\nLinear mixed-effects model fit by REML\n  Data: data2 \n       AIC      BIC    logLik\n  4506.861 4538.495 -2246.431\n\nRandom effects:\n Formula: ~1 | hospital\n        (Intercept)\nStdDev:    10.11958\n\n Formula: ~1 | cid %in% hospital\n        (Intercept) Residual\nStdDev:    6.211722  4.83313\n\nFixed effects:  zbi ~ 0 + w + randomize * time \n                    Value Std.Error  DF   t-value p-value\nw               0.7929278 1.2301340 215  0.644587  0.5199\nrandomize      -2.2676853 1.0298003 215 -2.202063  0.0287\ntime            0.1224763 0.0292666 460  4.184851  0.0000\nrandomize:time -0.0591068 0.0434111 460 -1.361560  0.1740\n Correlation: \n               w      randmz time  \nrandomize      -0.204              \ntime           -0.013  0.284       \nrandomize:time  0.008 -0.381 -0.674\n\nStandardized Within-Group Residuals:\n        Min          Q1         Med          Q3         Max \n-3.67241081 -0.51089297 -0.07170641  0.44724560  4.31123786 \n\nNumber of Observations: 682\nNumber of Groups: \n         hospital cid %in% hospital \n                5               221 \n\nShow the codemod2 <- lme(zbi ~ 0 + randomize * time,\n            random = list(~1 | hospital,\n                          ~1 | cid), \n            weights = ~ I(1/w),\n            data = data2)\n\nsummary(mod2)\n\nLinear mixed-effects model fit by REML\n  Data: data2 \n       AIC      BIC    logLik\n  4561.917 4589.041 -2274.959\n\nRandom effects:\n Formula: ~1 | hospital\n        (Intercept)\nStdDev:    10.61629\n\n Formula: ~1 | cid %in% hospital\n        (Intercept) Residual\nStdDev:    6.064869 4.635568\n\nVariance function:\n Structure: fixed weights\n Formula: ~I(1/w) \nFixed effects:  zbi ~ 0 + randomize * time \n                    Value Std.Error  DF   t-value p-value\nrandomize      -2.0002746 1.0076933 216 -1.985003  0.0484\ntime            0.1247430 0.0303855 460  4.105347  0.0000\nrandomize:time -0.0612263 0.0432489 460 -1.415673  0.1575\n Correlation: \n               randmz time  \ntime            0.300       \nrandomize:time -0.390 -0.702\n\nStandardized Within-Group Residuals:\n        Min          Q1         Med          Q3         Max \n-4.41375348 -0.49606846 -0.06911306  0.40653634  4.48115293 \n\nNumber of Observations: 682\nNumber of Groups: \n         hospital cid %in% hospital \n                5               221 \n\n\n\nShow the code#|: warnings = false\ntidy(mod0)\n\nWarning in tidy.lme(mod0): ran_pars not yet implemented for multiple levels of\nnesting\n\n\n\n\n  \n\n\nShow the codetidy(mod1)\n\nWarning in tidy.lme(mod1): ran_pars not yet implemented for multiple levels of\nnesting\n\n\n\n\n  \n\n\nShow the codetidy(mod2)\n\nWarning in tidy.lme(mod2): ran_pars not yet implemented for multiple levels of\nnesting\n\n\nWarning in tidy.varFunc(x$modelStruct$varStruct): Variance function structure\nof classvarFixedwith no parameters, or uninitialized"
  },
  {
    "objectID": "03_logistic.html",
    "href": "03_logistic.html",
    "title": "\n4  03_logistic\n",
    "section": "",
    "text": "Codeload(\"new_data/demo_clean_caregiver_merge_2_2023-11-02.Rdata\") \n\n\n\n\n\nThe dataset we used for caregiver table1 Section 2.1\n\nCodecaregiver_table_2\n\n\n\n  \n\n\n\nThe only missing we have would be the caregivers without any patient.\n\nCodenames(caregiver_table_2)\n\n#>  [1] \"cid\"               \"pid\"               \"age\"              \n#>  [4] \"age_binary\"        \"gender\"            \"language\"         \n#>  [7] \"ethnicity\"         \"race\"              \"primary_caregiver\"\n#> [10] \"primary_reason\"    \"hours\"             \"household\"        \n#> [13] \"relationship\"      \"employed\"          \"education\"        \n#> [16] \"income\"            \"randomize\"         \"diagnosis\"        \n#> [19] \"stage\"             \"step\"              \"hospital\"\n\nCode## the missing pattern\nnlmeU:::missPat(caregiver_table_2) %>% table()\n\n#> .\n#> --------------------- -X------------------- \n#>                   229                    20\n\n\n\nCodeset.seed(555)\n\nps_mod1 <- glm(randomize ~ 0 + primary_caregiver + primary_reason + employed + \n                      education + language + gender + ethnicity + race + diagnosis +\n                      stage + step + income + household + age + \n                      relationship + hours + hospital,\n                    data = caregiver_table_2,\n                    family = binomial(\"logit\"))\n\n\n\nCodesummary(ps_mod1)\n\n#> \n#> Call:\n#> glm(formula = randomize ~ 0 + primary_caregiver + primary_reason + \n#>     employed + education + language + gender + ethnicity + race + \n#>     diagnosis + stage + step + income + household + age + relationship + \n#>     hours + hospital, family = binomial(\"logit\"), data = caregiver_table_2)\n#> \n#> Deviance Residuals: \n#>     Min       1Q   Median       3Q      Max  \n#> -1.9561  -1.0650   0.5669   1.0612   1.7059  \n#> \n#> Coefficients:\n#>                      Estimate Std. Error z value Pr(>|z|)  \n#> primary_caregiver1 -13.547373 882.744916  -0.015   0.9878  \n#> primary_caregiver2 -13.669333 882.744928  -0.015   0.9876  \n#> primary_reason1      0.795436   1.067585   0.745   0.4562  \n#> primary_reason2     -0.052675   1.062905  -0.050   0.9605  \n#> employed2            0.095366   0.354098   0.269   0.7877  \n#> education1          16.519508 882.744633   0.019   0.9851  \n#> education2          15.804362 882.744555   0.018   0.9857  \n#> language2           -1.279793   0.668554  -1.914   0.0556 .\n#> gender2             -0.407319   0.357005  -1.141   0.2539  \n#> ethnicity2          -0.438685   0.431106  -1.018   0.3089  \n#> race2                0.301650   0.423711   0.712   0.4765  \n#> diagnosis2           0.459827   0.324561   1.417   0.1566  \n#> stage1              -0.829776   0.837755  -0.990   0.3219  \n#> stage2              -0.905840   0.821815  -1.102   0.2704  \n#> step2               -0.154934   0.367532  -0.422   0.6734  \n#> income1             -0.128613   0.770628  -0.167   0.8675  \n#> income2              0.391665   0.825828   0.474   0.6353  \n#> household1          -0.788355   1.046429  -0.753   0.4512  \n#> household2          -1.109448   1.039744  -1.067   0.2860  \n#> household3          -1.557446   1.075165  -1.449   0.1475  \n#> age                  0.004239   0.014645   0.289   0.7722  \n#> relationship2        0.831422   0.422868   1.966   0.0493 *\n#> relationship3        0.659467   0.517169   1.275   0.2023  \n#> hours1              -0.970847   0.560519  -1.732   0.0833 .\n#> hours2              -0.438838   0.521424  -0.842   0.4000  \n#> hospital2            1.005904   0.620221   1.622   0.1048  \n#> hospital3            0.584849   0.482582   1.212   0.2255  \n#> hospital4            0.414075   0.549455   0.754   0.4511  \n#> hospital5            1.573566   0.871338   1.806   0.0709 .\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> (Dispersion parameter for binomial family taken to be 1)\n#> \n#>     Null deviance: 345.19  on 249  degrees of freedom\n#> Residual deviance: 309.86  on 220  degrees of freedom\n#> AIC: 367.86\n#> \n#> Number of Fisher Scoring iterations: 13\n\nCodetidy(ps_mod1)"
  },
  {
    "objectID": "03_logistic.html#sec-c3-inla-logstic",
    "href": "03_logistic.html#sec-c3-inla-logstic",
    "title": "\n4  03_logistic\n",
    "section": "\n4.2 INLA logistic",
    "text": "4.2 INLA logistic\n\nCodeinla1 <-randomize ~ 0 + primary_caregiver + primary_reason + employed + \n                      education + language + gender + ethnicity + race + diagnosis +\n                      stage + step + income + household + age + \n                      relationship + hours + hospital\n\n# ps_inla1 <- inla(inla1, family = \"binomial\", \n#                data = caregiver,\n#                Ntrials = 1,\n#                keep = TRUE)\n\nps_inla1 <- inla(inla1, family = \"binomial\", \n               data = caregiver_table_2,\n               Ntrials = 1,\n               keep = TRUE,\n               ## saving the inla file\n               # working.directory = \"ini/ini_file_inla_p\",\n               ## this is imputing the missing values in inla\n               control.predictor = list(compute = TRUE),\n               control.compute = list(return.marginals.predictor = TRUE,\n                                      cpo = TRUE,\n                                      dic = TRUE,\n                                      waic = TRUE,\n                                      config = TRUE))\n\n\nHere is the logistic results \\(\\beta\\)\n\nCoderound(ps_inla1$summary.fixed, 4)\n\n\n\n  \n\n\n\n\nCode## add the weights into the dataset\ncaregiver_table_2 %<>%\n  mutate(ps = ps_inla1$summary.fitted.values$mode) %>%\n  mutate(weights = ifelse(randomize == 1, 1 / ps, 1 / (1 - ps)))\n\ncaregiver_score <- read.csv(\"new_data/score_caregiver_survey_scored.csv\")\n\ncaregiver_longitudinal <- caregiver_score %>%\n  mutate(cid = as.character(uniqueid2)) %>%\n  dplyr::select(-record_id, -spanish, -randomize, -language,\n                -stage, -stage2, -diagnosis, -diagn.lc, \n                -gender_clean, -hospital, -status2) %>%\n  full_join(caregiver_table_2, by = join_by(cid == cid)) %>%\n  dplyr::select(cid, pid, randomize, everything())\n\n# save(caregiver_longitudinal, \n#      file = paste0(\"new_data/longitudinal_demo_score_caregiver_\", Sys.Date(), \".csv\"))\n# save(caregiver_longitudinal, \n#      file = paste0(\"new_data/longitudinal_demo_score_caregiver_\", Sys.Date(), \".Rdata\"))\n\n\n\nCodenames(caregiver_longitudinal)\n\n#>  [1] \"cid\"               \"pid\"               \"randomize\"        \n#>  [4] \"uniqueid2\"         \"time\"              \"n.times\"          \n#>  [7] \"time.first\"        \"time.last\"         \"pss\"              \n#> [10] \"zbi\"               \"anxraw\"            \"depraw\"           \n#> [13] \"cops\"              \"anx_score\"         \"depr_score\"       \n#> [16] \"hads\"              \"age\"               \"age_binary\"       \n#> [19] \"gender\"            \"language\"          \"ethnicity\"        \n#> [22] \"race\"              \"primary_caregiver\" \"primary_reason\"   \n#> [25] \"hours\"             \"household\"         \"relationship\"     \n#> [28] \"employed\"          \"education\"         \"income\"           \n#> [31] \"diagnosis\"         \"stage\"             \"step\"             \n#> [34] \"hospital\"          \"ps\"                \"weights\"\n\nCodenlmeU:::missPat(caregiver_longitudinal) %>% table()\n\n#> .\n#> ------------------------------------ --------------XX-------------------- \n#>                                  682                                    9 \n#> -------------X-X-------------------- -------------XXX-------------------- \n#>                                    3                                   16 \n#> ------------X----------------------- ----------X-X----------------------- \n#>                                    1                                    1 \n#> --------X--------------------------- --------X-----XX-------------------- \n#>                                   19                                    1 \n#> --------X----XXX-------------------- --------X--X------------------------ \n#>                                    2                                    1 \n#> --------XXXXXXXX-------------------- -X---------------------------------- \n#>                                    1                                   49 \n#> -X------------XX-------------------- -X-----------XXX-------------------- \n#>                                    1                                    3 \n#> -X---------X------------------------ -X-------X-------------------------- \n#>                                    1                                    1 \n#> -X------X--------------------------- \n#>                                    1\n\n\n\nCode# Use the delightful Isfahan1 palette from the MetBrewer package\nisfahan <- MetBrewer::met.brewer(\"Isfahan1\")\n\n# # Custom ggplot theme to make pretty plots\n# # Get Archivo Narrow at https://fonts.google.com/specimen/Archivo+Narrow\n# theme_nice <- function() {\n#   theme_minimal(base_family = \"Archivo Narrow\") +\n#     theme(panel.grid.minor = element_blank(),\n#           plot.background = element_rect(fill = \"white\", color = NA),\n#           plot.title = element_text(face = \"bold\"),\n#           axis.title = element_text(face = \"bold\"),\n#           strip.text = element_text(face = \"bold\", size = rel(0.8), hjust = 0),\n#           strip.background = element_rect(fill = \"grey80\", color = NA),\n#           legend.title = element_text(face = \"bold\"))\n# }\n# \n# # Use this theme on all plots\n# theme_set(\n#   theme_nice()\n# )\n# \n# # Make all labels use Archivo by default\n# update_geom_defaults(\"label\", \n#                      list(family = \"Archivo Narrow\",\n#                           fontface = \"bold\"))\n\nplot4 <- ggplot() + \n  geom_histogram(data = filter(caregiver_longitudinal, randomize == 1), \n                 bins = 30, aes(x = ps), \n                 fill = isfahan[2]) + \n  geom_histogram(data = filter(caregiver_longitudinal, randomize == 0), \n                 bins = 30, aes(x = ps, y = -..count..), \n                 fill = isfahan[6]) +\n  geom_hline(yintercept = 0) +\n  annotate(geom = \"label\", x = 0.1, y = 20, label = \"Treated\", \n           color = \"black\", hjust = 0) +\n  annotate(geom = \"label\", x = 0.1, y = -20, label = \"Untreated\", \n           color = \"black\", hjust = 0) +\n  scale_y_continuous(label = abs) +\n  coord_cartesian(xlim = c(0, 1), ylim = c(-150, 150)) +\n  labs(x = \"Propensity\", y = \"Count\")\n\n\nplot5 <- ggplot() + \n  geom_histogram(data = filter(caregiver_longitudinal, randomize == 1), \n                 bins = 30, aes(x = ps, weight = weights), \n                 fill = colorspace::lighten(isfahan[2], 0.35)) + \n  geom_histogram(data = filter(caregiver_longitudinal, randomize == 0), \n                 bins = 30, aes(x = ps, weight = weights, y = -..count..),\n                 fill = colorspace::lighten(isfahan[6], 0.35)) +\n  geom_histogram(data = filter(caregiver_longitudinal, randomize == 1), \n                 bins = 30, aes(x = ps), \n                 fill = isfahan[2]) + \n  geom_histogram(data = filter(caregiver_longitudinal, randomize == 0), \n                 bins = 30, aes(x = ps, y = -..count..),\n                 fill = isfahan[6]) +\n  annotate(geom = \"label\", x = 0.8, y = 140, label = \"Treated (actual)\", \n           fill = isfahan[2], color = \"white\", hjust = 1) +\n  annotate(geom = \"label\", x = 0.8, y = 120, label = \"Treated (IPTW pseudo-population)\", \n           fill = colorspace::lighten(isfahan[2], 0.35), color = \"white\", hjust = 1) +\n  annotate(geom = \"label\", x = 0.8, y = -120, label = \"Untreated (actual)\", \n           fill = isfahan[6], color = \"white\", hjust = 1) +\n  annotate(geom = \"label\", x = 0.8, y = -140, label = \"Untreated (IPTW pseudo-population)\", \n           fill = colorspace::lighten(isfahan[6], 0.35), color = \"white\", hjust = 1) +\n  geom_hline(yintercept = 0, color = \"white\", size = 0.25) +\n  scale_y_continuous(label = abs) +\n  coord_cartesian(xlim = c(0, 1), ylim = c(-150, 150)) +\n  labs(x = \"Propensity\", y = \"Count\") \n\n#> Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\n#> ℹ Please use `linewidth` instead.\n\n\n\nCodeplot4 + theme_bw()\n\n#> Warning: The dot-dot notation (`..count..`) was deprecated in ggplot2 3.4.0.\n#> ℹ Please use `after_stat(count)` instead.\n\n\n\n\nPropensity Score Correction\n\n\n\nCodeplot5 + theme_bw()\n\n\n\nPropensity Score Correction"
  }
]